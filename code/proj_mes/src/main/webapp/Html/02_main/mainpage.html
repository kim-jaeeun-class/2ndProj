<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인 페이지</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* 차트 캔버스의 최대 높이 설정 */
        canvas {
            max-height: 250px; /* 차트 높이 조정 */
        }

        /* Tailwind 클래스 대신 직접 정의한 색상 변수 */
        :root {
            --header-bg: rgb(24, 33, 49);
            --nav-bg: rgb(17, 24, 39);
        }

        /* 호버 및 활성화 스타일 */
        .mainList li {
            position: relative;
            transition-property: background-color, border-left-color;
            transition-duration: 200ms;
        }

        .mainList li:hover {
            background-color: rgb(24, 33, 49);
        }
        
        /* 활성화된 부모 메뉴 스타일 */
        .active-parent {
            background-color: rgb(24, 33, 49);
            border-left: 4px solid #3b82f6;
            padding-left: 12px;
        }

        /* 활성화된 메뉴 아이템 스타일 */
        .active-link {
            background-color: rgb(24, 33, 49);
            border-left: 4px solid #3b82f6;
            padding-left: 12px;
        }

        .header-bg {
            background-color: var(--header-bg);
        }

        .nav-bg {
            background-color: var(--nav-bg);
        }

        /* 서브 메뉴 애니메이션 효과 */
        .subList {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out;
        }
        
        .subList.visible {
            max-height: 200px; /* 서브 메뉴 높이에 맞게 조절 */
            opacity: 1;
        }

        /* 공지사항 및 게시판 탭 버튼 스타일 */
        #noticeTab, #boardTab {
            color: #d1d5db; /* 초기 텍스트 색상 */
            border-bottom-color: transparent;
            transition: border-bottom-color 0.2s, color 0.2s;
        }

        #noticeTab.active, #boardTab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        
        /* 공지사항 및 게시판 항목 호버 스타일 */
        #noticeContent p:hover, #boardContent p:hover {
            background-color: #3b82f6; /* 파란색으로 변경 */
            color: white;
            transition: background-color 0.2s, color 0.2s;
        }

        #noticeContent p:hover span, #boardContent p:hover span {
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">

    <header class="header-bg text-white p-4 shadow-lg flex justify-between items-center z-50 relative">
        <div class="flex items-center space-x-2">
            <img src="https://i.postimg.cc/qMsq73hD/icon.png" class="w-10" alt="회사 로고">
            <h3 class="text-xl font-bold">J2P4</h3>
        </div>
        <div class="flex items-center space-x-4 sm:space-x-8">
            <div class="search cursor-pointer">
                <img src="https://i.postimg.cc/9QcMwQym/magnifier-white.png" class="w-6 sm:w-7" alt="검색용 아이콘">
            </div>
            <div class="logout text-sm sm:text-base cursor-pointer hover:underline">
                <form id="logoutForm" method="post" style="display:none"></form>
                <a href="#" id="logoutLink">로그아웃</a>
            </div>
            <div class="myIcon relative">
                <a href="javascript:void(0);" id="myIconBtn">
                    <img src="https://i.postimg.cc/zfVqTbvr/user.png" class="w-8 sm:w-9 rounded-full bg-white" alt="마이페이지 아이콘">
                </a>
            </div>
        </div>
    </header>

    <div class="flex flex-1">
        <aside class="nav-bg text-white p-4 w-56 shadow-inner flex-shrink-0">
            <ul class="mainList space-y-2 text-base">
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">메인</li>
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">기준 관리</li>
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">공정 관리</li>
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">BOM 관리</li>
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">발주 관리</li>
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">재고 관리</li>
                
                <li class="parent-menu relative rounded-md cursor-pointer transition-colors duration-200">
                    <div class="flex items-center justify-between p-3">
                        <span>생산 관리</span>
                        <svg class="w-4 h-4 transition-transform duration-200" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <ul class="subList space-y-1 mt-2">
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">생산 계획</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">작업 지시서</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">생산 실적</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">생산 불량률</li>
                    </ul>
                </li>
                
                <li class="parent-menu relative rounded-md cursor-pointer transition-colors duration-200">
                    <div class="flex items-center justify-between p-3">
                        <span>품질 관리</span>
                        <svg class="w-4 h-4 transition-transform duration-200" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <ul class="subList space-y-1 mt-2">
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">입고 검사</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">공정 검사</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">출하 검사</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">불량 보고서</li>
                    </ul>
                </li>
                
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">품목 관리</li>
            </ul>
        </aside>

        <main class="main-content flex-1 p-4 sm:p-8 overflow-y-auto">
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-white p-6 rounded-xl shadow-xl space-y-4">
                            <h3 class="text-xl font-semibold mb-2">생산 현황</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-4 rounded-lg shadow-inner border-t-4 border-blue-600">
                                    <span class="text-sm text-gray-500">총 생산량 ( 단위 : 개 )</span>
                                    <strong class="block text-2xl font-bold text-blue-700">15,251</strong>
                                </div>
                                <div class="p-4 rounded-lg shadow-inner border-t-4 border-blue-600">
                                    <span class="text-sm text-gray-500">목표 달성률 ( % )</span>
                                    <strong class="block text-2xl font-bold text-blue-700">89.6%</strong>
                                </div>
                                <div class="p-4 rounded-lg shadow-inner border-t-4 border-red-600">
                                    <span class="text-sm text-gray-500">누적 불량 수 ( 단위 : 개 )</span>
                                    <strong class="block text-2xl font-bold text-red-600">291</strong>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-xl space-y-4">
                            <h3 class="text-xl font-semibold mb-2">불량 현황 및 작업 지시</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h4 class="text-lg font-medium mb-2">월별 불량률 추이</h4>
                                    <canvas id="defectChart" class="w-full h-48"></canvas>
                                </div>
                                <div>
                                    <h4 class="text-lg font-medium mb-2">월별 작업 지시 달성률</h4>
                                    <canvas id="workOrderChart" class="w-full h-48"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-1 space-y-6 flex flex-col">
                        <div class="bg-white p-6 rounded-xl shadow-xl flex-1 flex flex-col">
                            <h3 class="text-xl font-semibold mb-2">재고 현황</h3>
                            <div class="flex-1 flex flex-col sm:flex-row items-center justify-center space-x-0 sm:space-x-4">
                                <!-- 커스텀 범례 (Legend) -->
                                <div class="flex-shrink-0 space-y-4 mb-4 sm:mb-0 sm:mr-4">
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 bg-blue-900 rounded-sm mr-2"></div>
                                        <span class="text-gray-700">원자재</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 bg-blue-600 rounded-sm mr-2"></div>
                                        <span class="text-gray-700">상품</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 bg-blue-400 rounded-sm mr-2"></div>
                                        <span class="text-gray-700">불량품</span>
                                    </div>
                                </div>
                                
                                <!-- 도넛 차트 -->
                                <canvas id="inventoryChart" class="w-full sm:w-3/5 h-auto max-h-48"></canvas>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-md flex-1">
                            <div class="flex border-b border-gray-200">
                                <button id="noticeTab" class="py-2 px-4 text-sm font-medium focus:outline-none border-b-2 border-transparent text-gray-500 hover:border-blue-600 hover:text-blue-600 transition-colors duration-200">
                                    공지 사항
                                </button>
                                <button id="boardTab" class="py-2 px-4 text-sm font-medium focus:outline-none border-b-2 border-transparent text-gray-500 hover:border-blue-600 hover:text-blue-600 transition-colors duration-200">
                                    게시판
                                </button>
                            </div>

                            <div id="noticeContent" class="tab-content space-y-2 mt-4">
                                <p class="py-2 px-1 rounded-md"><span class="text-gray-500">[안내]</span> <span class="text-gray-800">2025년 하반기 생산 목표 공지</span></p>
                                <p class="py-2 px-1 rounded-md"><span class="text-gray-500">[긴급]</span> <span class="text-gray-800">라인2 설비 점검 일정 변경</span></p>
                                <p class="py-2 px-1 rounded-md"><span class="text-gray-500">[공유]</span> <span class="text-gray-800">안전 수칙 교육 일정 안내</span></p>
                            </div>

                            <div id="boardContent" class="tab-content hidden space-y-2 mt-4">
                                <p class="py-2 px-1 rounded-md"><span class="text-gray-500">[공지]</span> <span class="text-gray-800">2025년 하반기 생산 목표 공지</span></p>
                                <p class="py-2 px-1 rounded-md"><span class="text-gray-500">[공지]</span> <span class="text-gray-800">라인2 설비 점검 일정 변경</span></p>
                                <p class="py-2 px-1 rounded-md"><span class="text-gray-500">[질문]</span> <span class="text-gray-800">MES 접속이 안되는데 어떻게...</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 사이드바 메뉴 토글 및 활성화 로직
            const menuItems = document.querySelectorAll('.mainList > li:not(.parent-menu)');
            const parentMenus = document.querySelectorAll('.parent-menu');
            const allItems = [...menuItems, ...document.querySelectorAll('.subList li')];

            function deactivateAll() {
                allItems.forEach(item => {
                    item.classList.remove('active-link');
                    item.classList.add('transition-colors', 'duration-200');
                });
                parentMenus.forEach(menu => {
                    menu.classList.remove('active-parent');
                    const subList = menu.querySelector('.subList');
                    const arrow = menu.querySelector('svg');
                    subList.classList.remove('visible');
                    arrow.style.transform = 'rotate(0deg)';
                });
            }

            const mainMenuItem = document.querySelector('.mainList > li:first-child');
            if (mainMenuItem) {
                mainMenuItem.classList.add('active-link');
                mainMenuItem.classList.remove('transition-colors', 'duration-200');
            }

            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    deactivateAll();
                    item.classList.add('active-link');
                    item.classList.remove('transition-colors', 'duration-200');
                });
            });

            parentMenus.forEach(parentMenu => {
                const subList = parentMenu.querySelector('.subList');
                const subMenuItems = subList.querySelectorAll('li');
                const arrow = parentMenu.querySelector('svg');

                parentMenu.addEventListener('click', () => {
                    const isParentActive = parentMenu.classList.contains('active-parent');
                    
                    if (isParentActive) {
                        subList.classList.remove('visible');
                        parentMenu.classList.remove('active-parent');
                    } else {
                        deactivateAll();
                        subList.classList.add('visible');
                        parentMenu.classList.add('active-parent');
                    }
                    
                    if (subList.classList.contains('visible')) {
                        arrow.style.transform = 'rotate(90deg)';
                    } else {
                        arrow.style.transform = 'rotate(0deg)';
                    }
                });

                subMenuItems.forEach(item => {
                    item.addEventListener('click', (event) => {
                        deactivateAll();
                        item.classList.add('active-link');
                        item.classList.remove('transition-colors', 'duration-200');
                        parentMenu.classList.add('active-parent');
                        subList.classList.add('visible');
                        parentMenu.querySelector('svg').style.transform = 'rotate(90deg)';
                        event.stopPropagation();
                    });
                });
            });

            /* ---------- 공지/게시판 탭 전환 로직 ---------- */
            const noticeTab = document.getElementById('noticeTab');
            const boardTab = document.getElementById('boardTab');
            const noticeContent = document.getElementById('noticeContent');
            const boardContent = document.getElementById('boardContent');

            function activateTab(tab, content) {
                // 모든 탭 비활성화
                document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                document.querySelectorAll('#noticeTab, #boardTab').forEach(t => t.classList.remove('active'));

                // 선택된 탭 활성화
                tab.classList.add('active');
                content.classList.remove('hidden');
            }

            activateTab(noticeTab, noticeContent); // 초기 상태

            noticeTab.addEventListener('click', () => activateTab(noticeTab, noticeContent));
            boardTab.addEventListener('click', () => activateTab(boardTab, boardContent));

            /* ---------- 사람 아이콘 드롭다운 로직 ---------- */
            const myIconBtn = document.getElementById('myIconBtn');
            const userMenu = document.getElementById('userMenu');

            function closeUserMenu() {
                if (userMenu) {
                    userMenu.classList.add('hidden');
                }
            }

            if (myIconBtn) {
                myIconBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (userMenu) {
                        userMenu.classList.toggle('hidden');
                    }
                });
            }

            if (userMenu) {
                userMenu.addEventListener('click', (e) => e.stopPropagation());
            }

            document.addEventListener('click', (e) => {
                // userMenu가 존재할 때만 확인
                if (userMenu && !myIconBtn.contains(e.target) && !userMenu.contains(e.target)) {
                    closeUserMenu();
                }
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeUserMenu();
            });

            /* ---------- Chart.js 초기화 ---------- */
            // 재고 현황 (Inventory Status) - 도넛 차트
            const invCtx = document.getElementById('inventoryChart').getContext('2d');
            new Chart(invCtx, {
                type: 'doughnut',
                data: {
                    labels: ['원자재', '상품', '불량품'],
                    datasets: [{
                        label: '재고 비율',
                        data: [6000, 3500, 500], // 예시 데이터
                        backgroundColor: ['#1e40af', '#2563eb', '#60a5fa'], // 파란색 계열의 색상
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '60%', // 도넛의 두께를 더 두껍게 조정
                    plugins: {
                        legend: { // Chart.js 범례를 숨기고 HTML로 직접 만듭니다.
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((acc, current) => acc + current, 0);
                                    const percentage = ((value / total) * 100).toFixed(1) + '%';
                                    return `${label}: ${value}개 (${percentage})`;
                                }
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            boxPadding: 4,
                            cornerRadius: 6,
                            displayColors: true // 툴팁에 색상 상자 표시
                        }
                    }
                }
            });

            // 월별 불량률 추이 (Monthly Defect Rate Trend) - 선 차트
            const defCtx = document.getElementById('defectChart').getContext('2d');
            const defChartGradient = defCtx.createLinearGradient(0, 0, 0, 200);
            defChartGradient.addColorStop(0, 'rgba(239, 68, 68, 0.4)');
            defChartGradient.addColorStop(1, 'rgba(239, 68, 68, 0)');
            new Chart(defCtx, {
                type: 'line',
                data: {
                    labels: ['1월', '2월', '3월', '4월', '5월', '6월'],
                    datasets: [{
                        label: '불량률 (%)',
                        data: [2.5, 2.1, 1.8, 2.0, 1.9, 2.2], // 예시 데이터
                        borderColor: '#ef4444',
                        backgroundColor: defChartGradient,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ef4444',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: (value) => value + '%' },
                            grid: { color: 'rgba(200, 200, 200, 0.2)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (t) => t.dataset.label + ': ' + t.raw + '%'
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            displayColors: false,
                            boxPadding: 4,
                            cornerRadius: 6
                        }
                    }
                }
            });

            // 월별 작업 지시 달성률 (Work Order Progress) - 꺾은선 차트
            const woCtx = document.getElementById('workOrderChart').getContext('2d');
            const woChartGradient = woCtx.createLinearGradient(0, 0, 0, 200);
            woChartGradient.addColorStop(0, 'rgba(59, 130, 246, 0.4)');
            woChartGradient.addColorStop(1, 'rgba(59, 130, 246, 0)');
            new Chart(woCtx, {
                type: 'line',
                data: {
                    labels: ['1월', '2월', '3월', '4월', '5월', '6월'],
                    datasets: [{
                        label: '목표 달성률 (%)',
                        data: [85, 90, 88, 95, 92, 89], // 예시 데이터
                        borderColor: '#2563eb',
                        backgroundColor: woChartGradient,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#2563eb',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: (value) => value + '%' },
                            grid: { color: 'rgba(200, 200, 200, 0.2)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (t) => t.dataset.label + ': ' + t.raw + '%'
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            displayColors: false,
                            boxPadding: 4,
                            cornerRadius: 6
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
