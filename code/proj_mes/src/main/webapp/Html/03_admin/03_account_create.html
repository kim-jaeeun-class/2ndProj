<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>계정 생성 페이지</title>
  <link rel="stylesheet" href="/proj_mes/Html/asset/template.css" />
  <link rel="stylesheet" href="/proj_mes/Html/asset/03_account_create.css" />
     <!-- 깨끗하고 현대적인 느낌을 주는 Inter 폰트 사용 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 동적 차트를 위한 Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* 차트 캔버스의 최대 높이 설정 */
        canvas {
            max-height: 200px;
        }

        .header-bg {
            background-color: #002a40;
        }

        .nav-bg {
            background-color: #003751;
        }

        .mainList, #noticeContent, #boardContent {
            cursor: pointer;
        }
        
        /* 메인 내비게이션 목록의 호버 배경색을 파란색으로 변경하여 글씨가 잘 보이게 수정 */
        .mainList li:hover {
            background-color: #3b82f6;
        }
    </style>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
</head>
<body>
    <header class="header-bg text-white p-4 shadow-lg flex justify-between items-center z-50 relative">
        <div class="flex items-center space-x-2">
        <a  href = "/proj_mes/mainpage">
            <img src="https://i.postimg.cc/qMsq73hD/icon.png" class="w-10" alt="회사 로고">
                       </a>
                       
          <a  href = "/proj_mes/mainpage">
            <h3 class="text-xl font-bold">J2P4</h3>
             </a>
 
        </div>
        <div class="flex items-center space-x-4 sm:space-x-8">
            <div class="search cursor-pointer">
                <img src="https://i.postimg.cc/9QcMwQym/magnifier-white.png" class="w-6 sm:w-7" alt="검색용 아이콘">
            </div>
            <div class="logout text-sm sm:text-base cursor-pointer hover:underline">
                <form method="post" action="/proj_mes/logout">
                    <button type="submit">로그아웃</button>
                </form>
            </div>

            <!-- 사람 아이콘 + 드롭다운 -->
            <div class="myIcon relative">
                <button id="myIconBtn" class="focus:outline-none" aria-haspopup="true" aria-expanded="false">
                    <img src="https://i.postimg.cc/zfVqTbvr/user.png" class="w-8 sm:w-9 rounded-full bg-white" alt="마이페이지 아이콘">
                </button>

                <!-- 드롭다운 메뉴 -->
                <div id="userMenu"
                    class="absolute right-0 mt-2 w-40 bg-white text-gray-800 rounded-lg shadow-lg border hidden z-50">
                    <a href="/proj_mes/AccountManage">계정관리</a><br>
                    <a href="/proj_mes/IssueCtrl">이슈처리</a><br>
                    <a href="/proj_mes/Client">거래처 관리</a>
                </div>
            </div>
        </div>
    </header>
        <!-- 메인 내비게이션 -->
    <nav class="nav-bg text-white py-2 shadow-inner z-40 relative">
        <ul class="mainList flex flex-wrap justify-center text-sm sm:text-base">
            <a href = "/proj_mes/StandardCtrl"><li class="relative px-2 sm:px-4 py-2 rounded-md">기준 관리</li></a>
            <a href = "/proj_mes/process"><li class="relative px-2 sm:px-4 py-2 rounded-md">공정 관리</li></a>
            <a href = "/proj_mes/bom"><li class="relative px-2 sm:px-4 py-2 rounded-md">BOM 관리</li></a>
            <a href = "/proj_mes/orderList"><li class="relative px-2 sm:px-4 py-2 rounded-md">발주 관리</li></a>
            <a href = "/proj_mes/stockList"><li class="relative px-2 sm:px-4 py-2 rounded-md">재고 관리</li></a>
            <a href = "/proj_mes/proplan"><li class="relative px-2 sm:px-4 py-2 rounded-md">생산 관리</li></a>
            <a href = "/proj_mes/items"><li class="relative px-2 sm:px-4 py-2 rounded-md">품목 관리</li></a>
            
            <li class="relative px-2 sm:px-4 py-2 rounded-md">품질 관리</li>
        </ul>
    </nav>



    <div class = "titleBox">
    <span style = "font-size: 30px;
    font-weight: bold;">계정 생성</span>
    </div>
   
  

  <div class="wrap" style = "width : 90%">
   


      <!-- ✅ 서버로 제출: action + method 지정 -->
      <form class="form" id="signupForm" action="/proj_mes/AccountCreate" method="post" autocomplete="off" novalidate>
        <div class="left">

		<div class="actions">
          <a class="btn secondary" href="#" onclick="history.back();return false;"><button type="button" class="back_btn">취소</button></a>
          <button type="submit" class="btn add_btn">등록</button>
        </div>

          <!-- ✅ 사번 -->
          <div class="row">
            <label for="worker_id">사번</label>
            <div class="field">
              <input id="worker_id" name="worker_id" type="text" required />
            </div>
          </div>
          <br />

          <!-- ✅ 이름 -->
          <div class="row">
            <label for="worker_name">이름</label>
            <div class="field">
              <input id="worker_name" name="worker_name" type="text" required />
            </div>
          </div>
          <br />

          <!-- ✅ 주민번호(6+7) -->
          <div class="row">
            <label for="rrn1">주민번호</label>
            <div class="field">
              <input id="rrn1" name="rrn1" type="text" inputmode="numeric" maxlength="6" placeholder="6자리" autocomplete="off" style="width:40%" />
              &nbsp;-&nbsp;
              <input id="rrn2" name="rrn2" type="text" inputmode="numeric" maxlength="7" placeholder="7자리" autocomplete="off" style="width:40%" />
            </div>
          </div>
          <br />

          <!-- ✅ 전화번호(3칸) -->
          <div class="row">
            <label>전화번호</label>
            <div class="field" style="display:flex;gap:6px;align-items:center">
              <input id="phone1" name="phone1" type="tel" inputmode="numeric" maxlength="3" placeholder="010" />
              <span>-</span>
              <input id="phone2" name="phone2" type="tel" inputmode="numeric" maxlength="4" />
              <span>-</span>
              <input id="phone3" name="phone3" type="tel" inputmode="numeric" maxlength="4" />
            </div>
          </div>
          <br />

          <!-- ✅ 비밀번호 / 확인 -->
          <div class="row">
            <label for="worker_pw">PW</label>
            <div class="field pw-wrap">
              <input id="worker_pw" name="worker_pw" type="password" autocomplete="new-password" required />
              <span class="pw-toggle" data-target="worker_pw">보기</span>
            </div>
          </div>
          <br />
          <div class="row">
            <label for="password_confirm">PW 확인</label>
            <div class="field pw-wrap">
              <input id="password_confirm" name="password_confirm" type="password" autocomplete="new-password" required />
              <span class="pw-toggle" data-target="password_confirm">보기</span>
            </div>
          </div>
          <br />
          <div class="hint" id="pwHint" hidden aria-live="polite"></div>

          <!-- ✅ 이메일 (id + 도메인) -->
          <div class="row inline">
            <label for="email_id">E-mail</label>
            <div class="field">
              <input id="email_id" name="email_id" type="text" placeholder="아이디" required />
              <span>@</span>
              <select id="email_domain" name="email_domain" required>
                <option value="">선택</option>
                <option value="gmail.com">gmail.com</option>
                <option value="naver.com">naver.com</option>
                <option value="daum.net">daum.net</option>
                <option value="hanmail.net">hanmail.net</option>
                <option value="kakao.com">kakao.com</option>
                <option value="custom">직접입력</option>
              </select>
              <input id="custom_domain" name="custom_domain" type="text" placeholder="도메인 직접 입력" style="display:none" />
            </div>
          </div>
          <br />

          <!-- 주소(서버 전송은 안 씀) -->
          <div class="row">
            <label for="address">주소</label>
            <div class="field" style="display:flex;gap:8px;align-items:center">
              <input id="address" name="address" type="text" placeholder="주소를 입력해주세요" readonly />
              <button class="btn secondary" type="button" id="addrSearch">검색</button>
            </div>
          </div>
          <br />
          <div class="row">
            <label for="detail_address">상세 주소</label>
            <div class="field">
              <input id="detail_address" name="detail_address" type="text" placeholder="상세 주소를 입력해주세요" />
            </div>
          </div>
          <br />

          <!-- ✅ 부서ID / 직급 / 권한 -->
          <div class="row">
            <label for="dapart_ID2">부서ID</label>
            <div class="field"><input id="dapart_ID2" name="dapart_ID2" type="text" style="width:40%" /></div>
          </div>
          <br />
          <div class="row">
            <label for="worker_grade">직급(숫자)</label>
            <div class="field"><input id="worker_grade" name="worker_grade" type="number" value="0" style="width:40%" /></div>
          </div>
          <br />
          <div class="row">
            <label for="worker_cando">권한(숫자)</label>
            <div class="field"><input id="worker_cando" name="worker_cando" type="number" value="0" style="width:40%" /></div>
          </div>
          <br/>
        </div>
      </form>

		<div class="list">
	      <div class="title box header_list">
	      	<div>감사 로그(Audit)</div>
        	<textarea id="auditLog" class="audit" placeholder="계정 생성 및 변경 내역이 이곳에 표시됩니다." readonly></textarea>
      	</div>
      </div>
  </div>
</div>


  <!-- 다음 우편번호 서비스 -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script>
    // 이메일 도메인 제어
    const emailDomain = document.getElementById('email_domain');
    const customDomain = document.getElementById('custom_domain');
    emailDomain.addEventListener('change', () => {
      if (emailDomain.value === 'custom') {
        customDomain.style.display = 'inline-block';
        customDomain.focus();
      } else {
        customDomain.style.display = 'none';
        customDomain.value = '';
      }
    });

    // 비밀번호 강도 및 확인
    const pw = document.getElementById('worker_pw');
    const pw2 = document.getElementById('password_confirm');
    const pwHint = document.getElementById('pwHint');

    function checkStrength(v){
      const len = v.length >= 8;
      const upper = /[A-Z]/.test(v);
      const lower = /[a-z]/.test(v);
      const num = /[0-9]/.test(v);
      const sp = /[^A-Za-z0-9]/.test(v);
      const repeat = /(.)\1{2,}/.test(v);
      const seq = /(012|123|234|345|456|567|678|789|abcd|bcde|cdef|defg)/i.test(v);
      if (!len) return '최소 8자 이상 입력하세요.';
      if (!(upper && lower)) return '영문 대소문자를 포함하세요.';
      if (!num) return '숫자를 포함하세요.';
      if (!sp) return '특수문자를 포함하세요.';
      if (repeat || seq) return '연속/반복되는 패턴은 금지됩니다.';
      return '';
    }
    function updateHint(){
      const v = pw.value;
      const msg = v ? checkStrength(v) : '';
      pwHint.textContent = msg;
      pwHint.hidden = !v || msg === '';
    }
    pw.addEventListener('input', updateHint);
    pw.addEventListener('blur', () => { if (!pw.value) pwHint.hidden = true; });

    // 비밀번호 보기 토글
    document.querySelectorAll('.pw-toggle').forEach(el=>{
      el.addEventListener('click', ()=>{
        const target = document.getElementById(el.dataset.target);
        const type = target.getAttribute('type') === 'password' ? 'text' : 'password';
        target.setAttribute('type', type);
        el.textContent = type === 'password' ? '보기' : '숨기기';
      });
    });

    // 전화번호 숫자만 입력
    ['phone1','phone2','phone3'].forEach(id=>{
      const $el = document.getElementById(id);
      $el.addEventListener('input',()=>{$el.value=$el.value.replace(/[^0-9]/g,'');});
    });

    // 주소 검색
    document.getElementById('addrSearch').addEventListener('click', ()=>{
      new daum.Postcode({
        oncomplete: function(data) {
          document.getElementById('address').value = data.address;
          document.getElementById('detail_address').focus();
        }
      }).open();
    });

    // ✅ 폼 제출: 검증 실패시에만 전송 취소
    const form = document.getElementById('signupForm');
    form.addEventListener('submit', (e)=>{
      updateHint();
      const msg = checkStrength(pw.value);
      if (msg) { e.preventDefault(); alert('비밀번호 조건을 확인해주세요.'); return; }
      if (pw.value !== pw2.value){ e.preventDefault(); alert('비밀번호가 일치하지 않습니다.'); return; }
      // 통과 시 e.preventDefault() 호출하지 않음 → 서버로 POST 전송
    });
    
    
    
    //드롭아웃
    const myIconBtn = document.getElementById('myIconBtn');
    const userMenu  = document.getElementById('userMenu');

    function closeUserMenu() {
        userMenu.classList.add('hidden');
        myIconBtn.setAttribute('aria-expanded', 'false');
    }

    myIconBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        userMenu.classList.toggle('hidden');
        myIconBtn.setAttribute('aria-expanded',
            userMenu.classList.contains('hidden') ? 'false' : 'true');
    });

    userMenu.addEventListener('click', (e) => e.stopPropagation());
    document.addEventListener('click', closeUserMenu);
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeUserMenu();
    });
    
    
  </script>
</body>
</html>
