<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>계정 생성 페이지</title>
  <link rel="stylesheet" href="/proj_mes/Html/asset/template.css" />
  <link rel="stylesheet" href="/proj_mes/Html/asset/03_account_create.css" />
</head>
<body>
  <header>
    <div class="corp">
      <img src="https://i.postimg.cc/qMsq73hD/icon.png" width="40" alt="회사 로고" />
      <h3>J2P4</h3>
    </div>
    <div class="search">
      <img src="https://i.postimg.cc/9QcMwQym/magnifier-white.png" width="30" alt="검색용 아이콘" />
    </div>
    <div class="logout">로그아웃</div>
    <div class="myIcon">
      <a href="javascript:void(0);" id="myIconBtn">
        <img src="https://i.postimg.cc/zfVqTbvr/user.png" width="35" alt="마이페이지 아이콘" style="background:#fff;border-radius:100%;" />
      </a>
      <ul class="subList">
        <li><a href="">하위메뉴1</a></li>
        <li><a href="">하위메뉴2</a></li>
      </ul>
    </div>
  </header>

  <div class="gnb">
    <ul class="mainList">
      <li>기준 관리
        <ul class="subList"><li><a href="">기준 목록</a></li></ul>
      </li>
      <li>공정 관리
        <ul class="subList">
          <li><a href="">공정 목록</a></li>
          <li><a href="">공정 등록/수정/삭제</a></li>
        </ul>
      </li>
      <li>BOM 관리
        <ul class="subList">
          <li><a href="">BOM 목록</a></li>
          <li><a href="">BOM 등록/수정/삭제</a></li>
        </ul>
      </li>
      <li>발주 관리
        <ul class="subList"><li><a href="">발주 목록</a></li></ul>
      </li>
      <li>재고 관리
        <ul class="subList">
          <li><a href="">재고 목록</a></li>
          <li><a href="">재고 삭제</a></li>
        </ul>
      </li>
      <li>생산 관리
        <ul class="subList">
          <li><a href="">생산 계획</a></li>
          <li><a href="">생산 실적 현황</a></li>
        </ul>
      </li>
      <li>품질 관리
        <ul class="subList">
          <li><a href="">LOT 추적</a></li>
          <li><a href="">공정별 현황</a></li>
          <li><a href="">품질 검사 입력</a></li>
        </ul>
      </li>
    </ul>
  </div>

  <div class="titleBox">
    <div>계정 생성</div>
   
  

  <div class="wrap">
   


      <!-- ✅ 서버로 제출: action + method 지정 -->
      <form class="form" id="signupForm" action="/proj_mes/AccountCreate" method="post" autocomplete="off" novalidate>
        <div class="left">

		<div class="actions">
          <a class="btn secondary" href="#" onclick="history.back();return false;"><button type="button" class="back_btn">취소</button></a>
          <button type="submit" class="btn add_btn">등록</button>
        </div>

          <!-- ✅ 사번 -->
          <div class="row">
            <label for="worker_id">사번</label>
            <div class="field">
              <input id="worker_id" name="worker_id" type="text" required />
            </div>
          </div>
          <br />

          <!-- ✅ 이름 -->
          <div class="row">
            <label for="worker_name">이름</label>
            <div class="field">
              <input id="worker_name" name="worker_name" type="text" required />
            </div>
          </div>
          <br />

          <!-- ✅ 주민번호(6+7) -->
          <div class="row">
            <label for="rrn1">주민번호</label>
            <div class="field">
              <input id="rrn1" name="rrn1" type="text" inputmode="numeric" maxlength="6" placeholder="6자리" autocomplete="off" style="width:40%" />
              &nbsp;-&nbsp;
              <input id="rrn2" name="rrn2" type="text" inputmode="numeric" maxlength="7" placeholder="7자리" autocomplete="off" style="width:40%" />
            </div>
          </div>
          <br />

          <!-- ✅ 전화번호(3칸) -->
          <div class="row">
            <label>전화번호</label>
            <div class="field" style="display:flex;gap:6px;align-items:center">
              <input id="phone1" name="phone1" type="tel" inputmode="numeric" maxlength="3" placeholder="010" />
              <span>-</span>
              <input id="phone2" name="phone2" type="tel" inputmode="numeric" maxlength="4" />
              <span>-</span>
              <input id="phone3" name="phone3" type="tel" inputmode="numeric" maxlength="4" />
            </div>
          </div>
          <br />

          <!-- ✅ 비밀번호 / 확인 -->
          <div class="row">
            <label for="worker_pw">PW</label>
            <div class="field pw-wrap">
              <input id="worker_pw" name="worker_pw" type="password" autocomplete="new-password" required />
              <span class="pw-toggle" data-target="worker_pw">보기</span>
            </div>
          </div>
          <br />
          <div class="row">
            <label for="password_confirm">PW 확인</label>
            <div class="field pw-wrap">
              <input id="password_confirm" name="password_confirm" type="password" autocomplete="new-password" required />
              <span class="pw-toggle" data-target="password_confirm">보기</span>
            </div>
          </div>
          <br />
          <div class="hint" id="pwHint" hidden aria-live="polite"></div>

          <!-- ✅ 이메일 (id + 도메인) -->
          <div class="row inline">
            <label for="email_id">E-mail</label>
            <div class="field">
              <input id="email_id" name="email_id" type="text" placeholder="아이디" required />
              <span>@</span>
              <select id="email_domain" name="email_domain" required>
                <option value="">선택</option>
                <option value="gmail.com">gmail.com</option>
                <option value="naver.com">naver.com</option>
                <option value="daum.net">daum.net</option>
                <option value="hanmail.net">hanmail.net</option>
                <option value="kakao.com">kakao.com</option>
                <option value="custom">직접입력</option>
              </select>
              <input id="custom_domain" name="custom_domain" type="text" placeholder="도메인 직접 입력" style="display:none" />
            </div>
          </div>
          <br />

          <!-- 주소(서버 전송은 안 씀) -->
          <div class="row">
            <label for="address">주소</label>
            <div class="field" style="display:flex;gap:8px;align-items:center">
              <input id="address" name="address" type="text" placeholder="주소를 입력해주세요" readonly />
              <button class="btn secondary" type="button" id="addrSearch">검색</button>
            </div>
          </div>
          <br />
          <div class="row">
            <label for="detail_address">상세 주소</label>
            <div class="field">
              <input id="detail_address" name="detail_address" type="text" placeholder="상세 주소를 입력해주세요" />
            </div>
          </div>
          <br />

          <!-- ✅ 부서ID / 직급 / 권한 -->
          <div class="row">
            <label for="dapart_ID2">부서ID</label>
            <div class="field"><input id="dapart_ID2" name="dapart_ID2" type="text" style="width:40%" /></div>
          </div>
          <br />
          <div class="row">
            <label for="worker_grade">직급(숫자)</label>
            <div class="field"><input id="worker_grade" name="worker_grade" type="number" value="0" style="width:40%" /></div>
          </div>
          <br />
          <div class="row">
            <label for="worker_cando">권한(숫자)</label>
            <div class="field"><input id="worker_cando" name="worker_cando" type="number" value="0" style="width:40%" /></div>
          </div>
          <br/>
        </div>
      </form>

		<div class="list">
	      <div class="title box header_list">
	      	<div>감사 로그(Audit)</div>
        	<textarea id="auditLog" class="audit" placeholder="계정 생성 및 변경 내역이 이곳에 표시됩니다." readonly></textarea>
      	</div>
      </div>
  </div>
</div>


  <!-- 다음 우편번호 서비스 -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script>
    // 이메일 도메인 제어
    const emailDomain = document.getElementById('email_domain');
    const customDomain = document.getElementById('custom_domain');
    emailDomain.addEventListener('change', () => {
      if (emailDomain.value === 'custom') {
        customDomain.style.display = 'inline-block';
        customDomain.focus();
      } else {
        customDomain.style.display = 'none';
        customDomain.value = '';
      }
    });

    // 비밀번호 강도 및 확인
    const pw = document.getElementById('worker_pw');
    const pw2 = document.getElementById('password_confirm');
    const pwHint = document.getElementById('pwHint');

    function checkStrength(v){
      const len = v.length >= 8;
      const upper = /[A-Z]/.test(v);
      const lower = /[a-z]/.test(v);
      const num = /[0-9]/.test(v);
      const sp = /[^A-Za-z0-9]/.test(v);
      const repeat = /(.)\1{2,}/.test(v);
      const seq = /(012|123|234|345|456|567|678|789|abcd|bcde|cdef|defg)/i.test(v);
      if (!len) return '최소 8자 이상 입력하세요.';
      if (!(upper && lower)) return '영문 대소문자를 포함하세요.';
      if (!num) return '숫자를 포함하세요.';
      if (!sp) return '특수문자를 포함하세요.';
      if (repeat || seq) return '연속/반복되는 패턴은 금지됩니다.';
      return '';
    }
    function updateHint(){
      const v = pw.value;
      const msg = v ? checkStrength(v) : '';
      pwHint.textContent = msg;
      pwHint.hidden = !v || msg === '';
    }
    pw.addEventListener('input', updateHint);
    pw.addEventListener('blur', () => { if (!pw.value) pwHint.hidden = true; });

    // 비밀번호 보기 토글
    document.querySelectorAll('.pw-toggle').forEach(el=>{
      el.addEventListener('click', ()=>{
        const target = document.getElementById(el.dataset.target);
        const type = target.getAttribute('type') === 'password' ? 'text' : 'password';
        target.setAttribute('type', type);
        el.textContent = type === 'password' ? '보기' : '숨기기';
      });
    });

    // 전화번호 숫자만 입력
    ['phone1','phone2','phone3'].forEach(id=>{
      const $el = document.getElementById(id);
      $el.addEventListener('input',()=>{$el.value=$el.value.replace(/[^0-9]/g,'');});
    });

    // 주소 검색
    document.getElementById('addrSearch').addEventListener('click', ()=>{
      new daum.Postcode({
        oncomplete: function(data) {
          document.getElementById('address').value = data.address;
          document.getElementById('detail_address').focus();
        }
      }).open();
    });

    // ✅ 폼 제출: 검증 실패시에만 전송 취소
    const form = document.getElementById('signupForm');
    form.addEventListener('submit', (e)=>{
      updateHint();
      const msg = checkStrength(pw.value);
      if (msg) { e.preventDefault(); alert('비밀번호 조건을 확인해주세요.'); return; }
      if (pw.value !== pw2.value){ e.preventDefault(); alert('비밀번호가 일치하지 않습니다.'); return; }
      // 통과 시 e.preventDefault() 호출하지 않음 → 서버로 POST 전송
    });
  </script>
</body>
</html>
