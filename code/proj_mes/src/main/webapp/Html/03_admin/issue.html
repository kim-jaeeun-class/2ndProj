<!-- 개선 사항 
 1: 체크 박스에 체크가 된 목록이 삽입, 삭제 되도록
 2 : 로그 형식을 구상할것
  -->

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>이슈 처리</title>
  <link rel="stylesheet" href="../asset/03_account_create.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    /* ===== Issue Manage (page-only) ===== */
:root{
  --text: #222;
  --muted: #666;
  --panel-bg: #fff;
  --chrome-border: #9b9b9b;
  --table-header: #eaf2ff;
  --table-line: #e5e7eb;
  --btn-bg: #f5f5f5;
  --btn-bg-hover: #eaeaea;
  --btn-border: #9d9d9d;
  --radius: 8px;

  --page-max: 1200px;
  --page-pad: 16px;
}

*, *::before, *::after { box-sizing: border-box; }

/* 컨테이너 */
.main{
  width: 90%;
  margin: 24px auto 56px;
}

/* 탭 */
.tabs{
  display: flex;
  gap: 8px;
  padding: 6px 0 10px;
}
.tab{
  border: 1px solid #a0a0a0;
  background: #e3e3e3;
  padding: 8px 14px;
  border-radius: 6px;
  font-weight: 700;
  cursor: default;
}
.tab.active{
  background: #3d3d3d; color: #fff; border-color: #2c2c2c;
}

/* 카드 */
.card{
  background: var(--panel-bg);
  border: 1px solid var(--chrome-border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-top: 14px;
}
.card-header{
  padding: 12px 16px;
  text-align: center;
  font-weight: 800;
  color: var(--text);                /* 템플릿과 충돌 방지 (흰 글씨 방지) */
  background: #f1f5f9;
  border-bottom: 1px solid var(--chrome-border);
}
.card-body{ 
  padding : 14px;
  width: 100%; 
}

/* 표 컨테이너 */
.table-wrap{
  border: 1px solid var(--table-line);
  border-radius: 6px;
  overflow: auto;
  max-height: 420px;                 /* 필요시 조절 */
  scrollbar-gutter: stable;          /* 스크롤 폭 확보로 헤더/바디 정렬 */
}

/* 표 본체 */
table.tables{
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}
table.tables th,
table.tables td{
  padding: 10px 12px;
  text-align: center;
  border-bottom: 1px solid var(--table-line);
  border-right: 1px solid var(--table-line);
}
table.tables th:last-child,
table.tables td:last-child{ border-right: 0; }

/* 헤더 sticky */
table.tables thead th{
  position: sticky;
  top: 0;
  z-index: 1;
  background: var(--table-header);
  font-weight: 800;
}

/* 행 상태/호버 */
table.tables tbody tr:hover{ background: #fafafa; }
.status-link{
  color: #1d4ed8;
  text-decoration: none;
  font-weight: 700;
}
.status-link:hover{ text-decoration: underline; }

/* 버튼 / 액션 */
.actions{
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding-top: 10px;
}
.btn{
  border: 1px solid var(--btn-border);
  background: var(--btn-bg);
  border-radius: 6px;
  padding: 8px 14px;
  font-weight: 700;
  cursor: pointer;
  color: #111;
}
.btn:hover{ background: var(--btn-bg-hover); }
.btn:disabled{
  opacity: .5; cursor: not-allowed;
}


/* 감사 로그 */
.audit-header{ text-align: left; }
.audit-textarea{
  width: 100%;
  min-height: 220px;
  border: 1px solid var(--table-line);
  border-radius: 6px;
  resize: vertical;
  background: #fcfcfc;
}

/* 체크박스 접근성(포커스 링) */
.row-check:focus,
#check-all:focus,
.btn:focus,
.page-num:focus{
  outline: 2px solid #60a5fa;
  outline-offset: 2px;
}

/* 모달 */
.modal_bg{
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  z-index: 999;
}
.modal_wrap{
  display: none;
  position: fixed;
  left: 50%; top: 50%;
  transform: translate(-50%, -50%);
  width: min(420px, 100% - 40px);
  background: #fff;
  border-radius: 10px;
  border: 1px solid #cbd5e1;
  box-shadow: 0 20px 60px rgba(0,0,0,.2);
  z-index: 1000;
  padding: 20px 18px 16px;
}
.modal_message{
  font-size: 16px;
  line-height: 1.5;
  text-align: center;
}
.modal_actions{
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-top: 14px;
}
.modal_close{
  border: 1px solid #334155;
  background: #111827;
  color: #fff;
  border-radius: 8px;
  padding: 8px 14px;
  cursor: pointer;
}
.modal_close:hover{ filter: brightness(1.06); }




    </style>



</head>
<body>
<main class="main">
  <!-- 상단 탭 (같은 디자인) -->
  <div class="tabs">
    <button class="tab active" role="tab" aria-selected="true">이슈</button>
    <button class="tab" role="tab" aria-selected="false">계정 관리</button>
  </div>

  <!-- 이슈 목록 카드 (같은 카드/테이블 구조) -->
  <section class="card">
    <header id="issue-title" class="card-header">이슈 처리</header>
    <div class="card-body">
      <div class="table-wrap" tabindex="0">
        <table class="tables" id="issue-table">
          <thead>
            <tr>
              <th scope="col"><input type="checkbox" id="check-all" aria-label="전체 선택" /></th>
              <th scope="col">문제</th>
              <th scope="col">상세내역</th>
              <th scope="col">상태</th>
              <th scope="col">요청자</th>
              <th scope="col">요청일</th>
              <th scope="col">액션</th>
            </tr>
          </thead>
          <tbody id="issue-tbody">
            <!-- 예시 데이터 (원하시면 서버 데이터로 대체) -->
            <tr>
              <td><input type="checkbox" class="row-check" /></td>
              <td>Line A scrap spike</td>
              <td>재열 처리 원인 분석 필요</td>
              <td><a href="#" class="status-link" data-status="open">open</a></td>
              <td>품질보증팀</td>
              <td>2025.08.30</td>
              <td>
                <button class="btn btn-approve" type="button">승인</button>
                <button class="btn btn-delete" type="button" data-name="Line A scrap spike">삭제</button>
              </td>
            </tr>
            <tr>
              <td><input type="checkbox" class="row-check" /></td>
              <td>공정 B 불량률 급증</td>
              <td>설비 교정 및 파라미터 점검</td>
              <td><a href="#" class="status-link" data-status="in_progress">open</a></td>
              <td>생산기술팀</td>
              <td>2025.08.29</td>
              <td>
                <button class="btn btn-approve" type="button">승인</button>
                <button class="btn btn-delete" type="button" data-name="공정 B 불량률 급증">삭제</button>
              </td>
            </tr>
            <tr>
              <td><input type="checkbox" class="row-check" /></td>
              <td>라인 C 안전센서 오류</td>
              <td>교체 필요 여부 판단</td>
              <td><a href="#" class="status-link" data-status="open">open</a></td>
              <td>안전관리팀</td>
              <td>2025.08.28</td>
              <td>
                <button class="btn btn-approve" type="button">승인</button>
                <button class="btn btn-delete" type="button" data-name="라인 C 안전센서 오류">삭제</button>
              </td>
            </tr>
            <!-- 필요 시 더 추가 -->
          </tbody>
        </table>
      </div>

      <!-- 하단 액션 (같은 버튼 스타일) -->
      <div class="actions">
        <button class="btn" type="button" id="btn-add">문제추가</button>
        <button class="btn" type="button" id="btn-bulk-approve" disabled>선택 승인</button>
        <button class="btn" type="button" id="btn-bulk-delete" disabled>선택 삭제</button>
      </div>

      <!-- 페이징: 표 아래 ‘가운데’ 정렬 -->
      <div class="actions" style="justify-content:center; gap:6px;">
        <button class="btn page-prev" type="button">이전</button>
        <button class="btn page-num is-active" type="button" data-page="1">1</button>
        <button class="btn page-num" type="button" data-page="2">2</button>
        <button class="btn page-num" type="button" data-page="3">3</button>
        <button class="btn page-next" type="button">다음</button>
      </div>
    </div>
  </section>

  <!-- 모달 (같은 팝업 구조/클래스) -->
  <div class="modal_bg" onclick="popClose();"></div>
  <div class="modal_wrap">
    <div class="modal_message"><span id="modal-target">선택한</span> 항목을 정말 삭제하시겠습니까?</div>
    <div class="modal_actions" style="margin-top:10px; text-align:center;">
      <button class="modal_close" id="modal-yes">예</button>
      <button class="modal_close" onclick="popClose();">아니요</button>
    </div>
  </div>

  <!-- 감사 로그 카드 (같은 구성) -->
  <section class="card">
    <header id="audit-title" class="card-header audit-header">감사 로그(Audit)</header>
    <div class="card-body">
      <textarea id="audit" class="audit-textarea"
        placeholder="시스템의 감사 로그가 여기에 표시됩니다."></textarea>
    </div>
  </section>
</main>

<script>
  // ----- 공통: 모달 열고 닫기 (같은 함수명 유지) -----
  function popOpen() {
    $('.modal_wrap').show();
    $('.modal_bg').show();
  }
  function popClose() {
    $('.modal_wrap').hide();
    $('.modal_bg').hide();
  }

  // ----- 페이지 로직(간단 샘플) -----
  $(function () {
    // 전체선택
    $('#check-all').on('change', function () {
      const checked = $(this).is(':checked');
      $('.row-check').prop('checked', checked);
      toggleBulkButtons();
    });

    // 개별선택
    $(document).on('change', '.row-check', function () {
      const all = $('.row-check').length;
      const checked = $('.row-check:checked').length;
      $('#check-all').prop('checked', all === checked);
      toggleBulkButtons();
    });

    // 선택 버튼 활성/비활성
    function toggleBulkButtons() {
      const has = $('.row-check:checked').length > 0;
      $('#btn-bulk-approve').prop('disabled', !has);
      $('#btn-bulk-delete').prop('disabled', !has);
    }

    // 삭제(개별)
    let pendingDeleteRow = null;
    $(document).on('click', '.btn-delete', function () {
      pendingDeleteRow = $(this).closest('tr');
      $('#modal-target').text($(this).data('name') || '선택한');
      popOpen();
    });

    // 삭제(일괄)
    $('#btn-bulk-delete').on('click', function () {
      $('#modal-target').text($('.row-check:checked').length + '개');
      pendingDeleteRow = 'bulk';
      popOpen();
    });

    // 모달 예
    $('#modal-yes').on('click', function () {
      if (pendingDeleteRow === 'bulk') {
        $('.row-check:checked').closest('tr').remove();
      } else if (pendingDeleteRow) {
        pendingDeleteRow.remove();
      }
      pendingDeleteRow = null;
      popClose();
      pushAudit('DELETE', '항목 삭제');
      toggleBulkButtons();
    });

    // 승인(개별)
    $(document).on('click', '.btn-approve', function () {
      const $row = $(this).closest('tr');
      $row.find('.status-link').text('resolved');
      pushAudit('RESOLVE', '완료 처리');
    });

    // 승인(일괄)
    $('#btn-bulk-approve').on('click', function () {
      $('.row-check:checked').each(function () {
        $(this).closest('tr').find('.status-link').text('resolved');
      });
      pushAudit('RESOLVE', '선택 항목 완료');
    });

    // 문제추가(샘플)
    $('#btn-add').on('click', function () {
      $('#issue-tbody').prepend(`
        <tr>
          <td><input type="checkbox" class="row-check" /></td>
          <td>신규 이슈</td>
          <td>세부내역을 입력하세요</td>
          <td><a href="#" class="status-link" data-status="open">open</a></td>
          <td>관리자</td>
          <td>${new Date().toISOString().slice(0,10).replaceAll('-','.')}</td>
          <td>
            <button class="btn btn-approve" type="button">승인</button>
            <button class="btn btn-delete" type="button" data-name="신규 이슈">삭제</button>
          </td>
        </tr>
      `);
      pushAudit('CREATE', '이슈 추가');
    });

    // 페이징(가운데, 활성 토글만)
    $('.page-num').on('click', function () {
      $('.page-num').removeClass('is-active');
      $(this).addClass('is-active');
      // 실제 데이터 페이징은 서버/스크립트에 맞춰 구현하세요.
    });

    // 상태 링크 클릭 (예: 상태 변경 메뉴 연결 자리)
    $(document).on('click', '.status-link', function (e) {
      e.preventDefault();
      // 필요 시 상태 변경 팝업/드롭다운 연결
    });

    // 감사 로그 기록
    function pushAudit(action, msg) {
      const t = new Date().toLocaleString();
      const prev = $('#audit').val();
      $('#audit').val(`[${t}] ${action} - ${msg}\n` + prev);
    }
  });
</script>
</body>
</html>
